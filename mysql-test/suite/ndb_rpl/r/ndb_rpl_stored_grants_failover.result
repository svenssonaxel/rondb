include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[connection master]
[Server D]
call mtr.add_suppression("You need to use --log-bin .*");
#
# Use server A to create a test table with one row, and a test user.
# Check that they replicate to all servers.
# (Also check that we have 4 different server IDs.)
#
[Server A]
select @@server_id;
@@server_id
1
CREATE TABLE t1 (pk INT PRIMARY KEY, a CHAR(1)) engine = ndb;
INSERT INTO t1 VALUES(1, 'A');
CREATE USER 'ndb_u1'@'localhost' IDENTIFIED by 'pass1';
GRANT NDB_STORED_USER ON *.* TO 'ndb_u1'@'localhost';
DROP USER 'ndb_u1'@'localhost';
CREATE USER 'ndb_u1'@'localhost' IDENTIFIED by 'pass1';
GRANT NDB_STORED_USER ON *.* TO 'ndb_u1'@'localhost';
SELECT * FROM t1;
pk	a
1	A
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
[Server B]
select @@server_id;
@@server_id
3
SELECT * FROM t1;
pk	a
1	A
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
[Server C]
select @@server_id;
@@server_id
2
SELECT * FROM t1;
pk	a
1	A
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
[Server D]
select @@server_id;
@@server_id
4
SELECT * FROM t1;
pk	a
1	A
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
#
# Change replication topology to go in the reverse direction.
#
include/rpl_reset.inc
[Server C]
Replica_IO_State=Waiting for master to send event
Replica_SQL_Running_State=Slave has read all relay log; waiting for more updates
include/stop_slave.inc
Replica_IO_State=
Replica_SQL_Running_State=
include/rpl_change_topology.inc [new topology=2->1]
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[Server A]
Replica_IO_State=
Replica_SQL_Running_State=
include/start_slave.inc
[Server C]
[Server A]
Replica_IO_State=Waiting for master to send event
Replica_SQL_Running_State=Slave has read all relay log; waiting for more updates
[Server C]
Replica_IO_State=
Replica_SQL_Running_State=
#
# Use server C to create a test table with one row, and a test user.
# Check that they replicate to all servers.
#
[Server C]
CREATE TABLE t2 (pk INT PRIMARY KEY, a CHAR(1)) engine = ndb;
INSERT INTO t2 VALUES(1, 'C');
CREATE USER 'ndb_u2'@'localhost' IDENTIFIED by 'pass2';
GRANT NDB_STORED_USER ON *.* TO 'ndb_u2'@'localhost';
DROP USER 'ndb_u2'@'localhost';
CREATE USER 'ndb_u2'@'localhost' IDENTIFIED by 'pass2';
GRANT NDB_STORED_USER ON *.* TO 'ndb_u2'@'localhost';
DROP USER 'ndb_u1'@'localhost';
CREATE USER 'ndb_u1'@'localhost' IDENTIFIED by 'pass1';
GRANT NDB_STORED_USER ON *.* TO 'ndb_u1'@'localhost';
SELECT * FROM t2;
pk	a
1	C
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
localhost	ndb_u2
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
'ndb_u2'@'localhost'
[Server D]
SELECT * FROM t2;
pk	a
1	C
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
localhost	ndb_u2
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
'ndb_u2'@'localhost'
[Server A]
SELECT * FROM t2;
pk	a
1	C
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u1
localhost	ndb_u2
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u1'@'localhost'
'ndb_u2'@'localhost'
[Server B]
SELECT * FROM t1;
pk	a
1	A
SELECT host, user FROM mysql.user WHERE user LIKE 'ndb_%';
host	user
localhost	ndb_u2
SELECT grantee FROM information_schema.user_privileges WHERE privilege_type='NDB_STORED_USER' ORDER BY grantee;
grantee
'ndb_u2'@'localhost'
# Cleanup
DROP USER ndb_u1@localhost;
DROP TABLE t1;
DROP USER ndb_u2@localhost;
DROP TABLE t2;
include/rpl_reset.inc
include/stop_slave.inc
include/rpl_change_topology.inc [new topology=1->2]
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
include/rpl_end.inc
